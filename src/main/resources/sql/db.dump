--
-- PostgreSQL database dump
--

-- Dumped from database version 11.1 (Debian 11.1-1.pgdg90+1)
-- Dumped by pg_dump version 11.0

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET client_min_messages = warning;
SET row_security = off;

--
-- Name: uuid-ossp; Type: EXTENSION; Schema: -; Owner: 
--

CREATE EXTENSION IF NOT EXISTS "uuid-ossp" WITH SCHEMA public;


--
-- Name: EXTENSION "uuid-ossp"; Type: COMMENT; Schema: -; Owner: 
--

COMMENT ON EXTENSION "uuid-ossp" IS 'generate universally unique identifiers (UUIDs)';


--
-- Name: miao(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.miao() RETURNS character varying
    LANGUAGE plpgsql
    AS $_$
declare
  id_at_commodity varchar;
  id_at_order     varchar;
BEGIN

  select id into id_at_commodity from commodity where b_sell = false for update skip locked limit 1;
  if id_at_commodity notnull
  then
    update commodity set b_sell = true where id = id_at_commodity;
    execute 'insert into orders (id_at_commodity) values ($1) RETURNING id' into id_at_order using id_at_commodity;
  end if;

  return id_at_order;
END;
$_$;


ALTER FUNCTION public.miao() OWNER TO postgres;

SET default_tablespace = '';

SET default_with_oids = false;

--
-- Name: commodity; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.commodity (
    id character varying DEFAULT public.uuid_generate_v4() NOT NULL,
    v_name character varying,
    n_price numeric,
    v_info character varying,
    b_sell boolean DEFAULT false
);


ALTER TABLE public.commodity OWNER TO postgres;

--
-- Name: orders; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.orders (
    id character varying DEFAULT public.uuid_generate_v4() NOT NULL,
    id_at_commodity character varying,
    t_create timestamp without time zone DEFAULT now()
);


ALTER TABLE public.orders OWNER TO postgres;

--
-- Data for Name: commodity; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.commodity (id, v_name, n_price, v_info, b_sell) FROM stdin;
1b30bae1-fa6a-4933-9d16-4d2e4368e75c	name_8	8	14d2e3d3c29f994f067fd4b74bca2a8d	f
2b83fa02-47e3-46b1-8c90-0831528b56eb	name_22	22	cfd33e6d294994ea9e8a3fda24a14af0	f
0c65ce8c-615d-4c04-84f4-afa272f3c1f3	name_75	75	fbf272016b0def4ef78e12a3189f3655	f
2fbbd4fe-fe4f-47c9-b25e-f71eb1f56134	name_91	91	f5c0e45904254c6375994f649f4a4151	f
c590dc4c-0385-4406-ab11-84ecbc735bce	name_66	66	bb84dab195dc22f30bfb92e146ff5717	f
7851483d-f564-4894-9797-069fc0f244e3	name_3	3	9d7d704c032ccf532eafd31696d27f85	f
166dc439-1e54-4927-b8c4-5476e44e82e7	name_11	11	5d17a6bbaf09b9e545ba56c8367b381c	f
6d7f86d5-2378-42eb-bcd1-b2da6c70501b	name_75	75	fbf272016b0def4ef78e12a3189f3655	f
063cc1ac-4dd6-404e-abc3-3f37bb934be5	name_18	18	9a199ac4970be7cc70d8ba8e13d763c9	f
5644bfb1-8eb4-42e3-9124-7d6ba8d9f181	name_6	6	ac345550f15da4f889530d1fcb478507	f
\.


--
-- Data for Name: orders; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.orders (id, id_at_commodity, t_create) FROM stdin;
\.


--
-- Name: commodity commodity_pk; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.commodity
    ADD CONSTRAINT commodity_pk PRIMARY KEY (id);


--
-- Name: orders orders_pk; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.orders
    ADD CONSTRAINT orders_pk PRIMARY KEY (id);


--
-- Name: commodity_b_sell_index2; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX commodity_b_sell_index2 ON public.commodity USING btree (b_sell);


--
-- PostgreSQL database dump complete
--

