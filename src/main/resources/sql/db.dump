--
-- PostgreSQL database dump
--

-- Dumped from database version 11.1 (Debian 11.1-1.pgdg90+1)
-- Dumped by pg_dump version 11.0

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET client_min_messages = warning;
SET row_security = off;

--
-- Name: uuid-ossp; Type: EXTENSION; Schema: -; Owner: 
--

CREATE EXTENSION IF NOT EXISTS "uuid-ossp" WITH SCHEMA public;


--
-- Name: EXTENSION "uuid-ossp"; Type: COMMENT; Schema: -; Owner: 
--

COMMENT ON EXTENSION "uuid-ossp" IS 'generate universally unique identifiers (UUIDs)';


--
-- Name: miao(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.miao() RETURNS character varying
    LANGUAGE plpgsql
    AS $_$
declare
  id_at_commodity varchar;
  id_at_order     varchar;
BEGIN

  select id into id_at_commodity from commodity where b_sell = false for update skip locked limit 1;
  if id_at_commodity notnull
  then
    update commodity set b_sell = true where id = id_at_commodity;
    execute 'insert into orders (id_at_commodity) values ($1) RETURNING id' into id_at_order using id_at_commodity;
  end if;

  return id_at_order;
END;
$_$;


ALTER FUNCTION public.miao() OWNER TO postgres;

SET default_tablespace = '';

SET default_with_oids = false;

--
-- Name: commodity; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.commodity (
    id character varying DEFAULT public.uuid_generate_v4() NOT NULL,
    v_name character varying,
    n_price numeric,
    v_info character varying,
    b_sell boolean DEFAULT false
);


ALTER TABLE public.commodity OWNER TO postgres;

--
-- Name: orders; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.orders (
    id character varying DEFAULT public.uuid_generate_v4() NOT NULL,
    id_at_commodity character varying,
    t_create timestamp without time zone DEFAULT now()
);


ALTER TABLE public.orders OWNER TO postgres;

--
-- Data for Name: commodity; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.commodity (id, v_name, n_price, v_info, b_sell) FROM stdin;
01fc0988-6aba-4449-857a-b6196a0a2f10	name_95	95	7ce2e3b2fb3cde545a6cbd310da39a54	f
65b19eea-758f-4b6f-8422-06c2562d90ba	name_4	4	9643c46f95c1412a6bf7fde38edc9f7c	f
d2addccf-6751-409d-b574-e639f040219f	name_26	26	7d18861f7fa1e99d1c89570464fdc3ab	f
98fc3f7f-471e-4f1d-b9c1-f095ea5eff29	name_45	45	aa633852a2ddf24f90a9a6d07f6a21fe	f
5427e75a-18f5-4153-ba90-2c886e589e0a	name_54	54	57caa3d1104ce988371eced39cba2d36	f
cb9960c6-a96e-42c8-82b6-70f1ec28fd77	name_14	14	a9766fb712e84568dfa95b9b20118e9d	f
115b2911-7409-471e-a343-6ad30f506cf6	name_84	84	e99df240129ce487432cfc9280e314a2	f
c69a21b1-cf5e-44a0-92c5-4a266cf5904d	name_51	51	71e4e974f6717813518911984bc3c563	f
ed2c358c-fab0-44bf-8b35-dd694b5f0792	name_84	84	e99df240129ce487432cfc9280e314a2	f
de801c87-3a81-405e-acc7-067f768a4a63	name_49	49	4d3e83d5da9471253880ce6a5ec716f9	f
\.


--
-- Data for Name: orders; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.orders (id, id_at_commodity, t_create) FROM stdin;
\.


--
-- Name: commodity commodity_pk; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.commodity
    ADD CONSTRAINT commodity_pk PRIMARY KEY (id);


--
-- Name: orders orders_pk; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.orders
    ADD CONSTRAINT orders_pk PRIMARY KEY (id);


--
-- PostgreSQL database dump complete
--

